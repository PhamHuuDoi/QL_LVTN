extends ../../layouts/default.pug

block main
  .container-fluid
    .d-flex.justify-content-between.align-items-center.mb-3
      h3.mb-0 Quản lý sinh viên
      form(method="post" action="/admin/sinhvien/import" enctype="multipart/form-data" class="mb-3")
        .form-row
            .col-md-6
                input.form-control(type="file" name="excelFile" accept=".xls,.xlsx" required)
            .col-md-3
                button.btn.btn-success(type="submit") Import từ Excel
            .col-md-3.text-right
                a.btn.btn-primary(href="/admin/sinhvien/create") + Thêm sinh viên

    form.form-inline.mb-3(method="GET", action="")
      input.form-control.mr-2(type="text", name="keyword", placeholder="Tìm kiếm theo tên hoặc MSSV", value=keyword)
      button.btn.btn-outline-success(type="submit") Tìm kiếm

    if sinhviens.length
      table.table.table-striped.table-bordered.table-hover
        thead.table-dark
          tr
            th(scope="col") #
            th(scope="col") Mã SV
            th(scope="col") Họ tên
            th(scope="col") Lớp
            th(scope="col") Ngành
            th(scope="col") Email
            th(scope="col") Nhóm
            th(scope="col") GVHD
            //th(scope="col") Ngày tạo
            th(scope="col" style="width: 120px") Thao tác
        tbody
          each sv, index in sinhviens
            tr
              td #{index + 1}
              td #{sv.msvv}
              td #{sv.ten}
              td #{sv.lop}
              td #{sv.nganh}
              td #{sv.email}
              td #{sv.group}
              td #{sv.supervisor ? sv.supervisor.hoten : '-'}
              //td #{sv.createdAtFormat}
              td.text-center

                a.btn.btn-sm.btn-warning.text-white(href=`/${prefixAdmin}/sinhvien/edit/${sv._id}`) Sửa
                button.btn.btn-sm.btn-danger.btn-delete(data-id=sv._id type="button") Xóa
    else
      p.text-muted.text-center.mt-4 Không có sinh viên nào.

  script.
    const prefixAdmin = '!{prefixAdmin}';
    document.querySelectorAll('.btn-delete').forEach(btn => {
      btn.addEventListener('click', async () => {
        const id = btn.getAttribute('data-id');
        const confirm = await Swal.fire({
          title: 'Xóa sinh viên?',
          text: 'Bạn chắc chắn muốn xóa sinh viên này?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Xóa',
          cancelButtonText: 'Hủy'
        });
        if (confirm.isConfirmed) {
          await fetch(`/${prefixAdmin}/sinhvien/delete/${id}`, { method: 'DELETE' });
          location.reload();
        }
      });
    });